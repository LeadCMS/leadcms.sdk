# Interactive Init Command

## Overview

The `leadcms init` command provides an interactive setup wizard to configure your LeadCMS SDK project. It automatically connects to your LeadCMS instance, fetches available languages, and sets up your environment with minimal configuration files.

## Features

### üîå Auto-Configuration from API
- Connects to public `/api/config` endpoint (no authentication required)
- Fetches default language automatically
- Shows all available languages

### üìÅ Smart File Management
- Creates `.env` or `.env.local` (if exists) with credentials
- Only creates `leadcms.config.json` if custom directories are used
- Prompts before overwriting existing files

### ‚ú® Intelligent Defaults
- Uses `.leadcms/content` for content directory (LeadCMS standard)
- Uses `public/media` for media directory (framework-agnostic)
- Only saves non-default values in config file

## Usage

```bash
npx leadcms init
```

## Interactive Flow

### 1. URL Input
```
Enter your LeadCMS URL (e.g., https://your-instance.leadcms.io):
```

Validates:
- URL format (must start with http:// or https://)
- Trailing slashes are removed automatically

### 2. API Key Input (Optional)
```
Enter your LeadCMS API Key (or press Enter for anonymous mode):
```

**Optional field:**
- Press Enter to skip (anonymous mode - public content only)
- Or enter API key for full access (read + write operations)

If you skip the API key (anonymous mode):
```
‚ÑπÔ∏è  Anonymous mode: Only public content will be accessible.
   Read operations will work, but write operations (push) will fail.
```

This is perfect for static site generators that only need public content!

### 3. CMS Configuration Fetch (Public Endpoint)
```
üîç Connecting to LeadCMS...
‚úÖ Connected successfully!

üìã Available languages:
   1. English (United States) [en-US] (default)
   2. Russian (Russia) [ru-RU]

‚úì Using default language: en-US
```

**Important:** The `/api/config` endpoint is **public** and requires **no authentication**. It works the same in both authenticated and anonymous mode.

Automatically:
- Fetches and displays available languages
- Uses CMS default language
- Shows language codes and names
- **Works without API key** (public endpoint)

If connection fails:
- Falls back to manual language input
- Continues with setup process

### 4. Directory Configuration
```
Content directory [.leadcms/content]:
Media directory [public/media]:
```

- Press Enter to accept defaults
- Or type custom path

### 5. File Creation
```
üìù Creating configuration files...

‚úÖ Updated .env
‚ÑπÔ∏è  Using default directories, no leadcms.config.json needed.
```

Creates:
- **`.env`** with `LEADCMS_URL`, `LEADCMS_API_KEY`, `LEADCMS_DEFAULT_LANGUAGE`
- **`leadcms.config.json`** only if custom directories specified

## API Endpoint: `/api/config` (Public Endpoint)

The init command calls `/api/config` **without authentication** - this is a public endpoint:

```http
GET /api/config
# NO Authorization header sent - this is a public endpoint
```

Response:
```json
{
  "auth": {
    "methods": ["Local", "AzureAD"],
    "msal": { ... }
  },
  "entities": ["Contact", "Content", "Comment", ...],
  "languages": [
    {
      "code": "en-US",
      "name": "English (United States)"
    },
    {
      "code": "ru-RU",
      "name": "Russian (Russia)"
    }
  ],
  "settings": { ... },
  "defaultLanguage": "en-US",
  "modules": [],
  "capabilities": []
}
```

The wizard uses:
- `defaultLanguage` - Sets `LEADCMS_DEFAULT_LANGUAGE` environment variable
- `languages[]` - Displays available languages to user

**Security:** This endpoint works without authentication, making it safe to call during initialization even in anonymous mode.

## Configuration Files Created

### .env or .env.local

**With API Key (Authenticated Mode):**
```bash
# LeadCMS Configuration
# Generated by leadcms init

LEADCMS_URL=https://your-instance.leadcms.io
LEADCMS_API_KEY=your-api-key-here
LEADCMS_DEFAULT_LANGUAGE=en-US
```

**Without API Key (Anonymous Mode):**
```bash
# LeadCMS Configuration
# Generated by leadcms init
# Running in anonymous mode - only public content accessible
# Add LEADCMS_API_KEY for write operations and private content

LEADCMS_URL=https://your-instance.leadcms.io
LEADCMS_DEFAULT_LANGUAGE=en-US
```

### leadcms.config.json (only if needed)

Only created if you specify non-default directories:

```json
{
  "contentDir": "custom/content/path",
  "mediaDir": "custom/media/path"
}
```

If both directories use defaults, no config file is created to keep your project clean.

## Error Handling

### Invalid URL
```
‚ùå Invalid URL format. Must start with http:// or https://
```

### Connection Failed
```
‚ùå Could not connect to LeadCMS. Please check the URL.
‚ö†Ô∏è  Could not fetch CMS configuration. Continuing with manual setup...
```

Falls back to manual language entry if API is unreachable.

**Note:** Since `/api/config` is a public endpoint, authentication errors should not occur during the fetch. Connection failures are typically due to network issues or incorrect URL.

## Overwrite Protection

If configuration files already exist:
```
‚ö†Ô∏è  Configuration files already exist. Overwrite? (y/N):
```

Type `y` or `yes` to overwrite, any other input cancels initialization.

## Next Steps

After running `leadcms init`:

1. **Pull content:**
   ```bash
   npx leadcms pull
   ```

2. **Start using SDK:**
   ```typescript
   import { getCMSContentBySlugForLocale } from '@leadcms/sdk';

   const content = getCMSContentBySlugForLocale('about', 'en-US');
   ```

## Advantages Over Manual Setup

| Feature | Manual Setup | `leadcms init` |
|---------|-------------|----------------|
| Default language | Must look up in CMS | Auto-detected from public API |
| Available languages | Unknown | Displayed during setup |
| API key requirement | Unclear | Optional with clear messaging |
| Anonymous mode | Must configure manually | Automatic setup with guidance |
| Config validation | Manual | Automatic |
| File creation | Multiple steps | Single command |
| Credential storage | Manual .env | Automatic .env update |
| Config file | Always created | Only if needed |

## Environment Variable Precedence

After `leadcms init`, the SDK loads configuration in this order:

1. Programmatic config (via `configure()`)
2. Environment variables (`.env`, `.env.local`)
3. Config file (`leadcms.config.json`)
4. Default values

This means environment variables override config file settings, which is best practice for security.
